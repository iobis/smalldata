plugins {
  id 'java'
  id 'application'
  id 'org.beryx.jlink' version '2.5.0'
  id 'org.javamodularity.moduleplugin' version '1.4.0'
}

repositories {
  mavenLocal()
  jcenter()
}
ext {
  vertxVersion = '3.6.3'
  junitJupiterEngineVersion = '5.2.0'
  moduleName = 'obis.smalldata'
}

sourceCompatibility = 11

group = 'org.obis'
version = '1.0.0-SNAPSHOT'
mainClassName = "$moduleName/org.obis.smalldata.Starter"

dependencies {
  implementation("io.vertx:vertx-core:$vertxVersion")
  implementation "io.vertx:vertx-jdbc-client:$vertxVersion"
  implementation "io.vertx:vertx-junit5:$vertxVersion"
  implementation "io.vertx:vertx-web:$vertxVersion"
  implementation "io.vertx:vertx-config:$vertxVersion"

  testImplementation "io.vertx:vertx-junit5:$vertxVersion"
  testRuntime("org.junit.jupiter:junit-jupiter-engine:$junitJupiterEngineVersion")
}

test {
  useJUnitPlatform()
  testLogging {
    events 'PASSED', 'FAILED', 'SKIPPED'
  }
}

jlink {
  options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages']
  mergedModule {
    additive = true
    uses 'io.vertx.core.spi.VertxFactory'
    uses 'io.vertx.core.spi.VerticleFactory'
    uses 'io.vertx.core.spi.FutureFactory'
    uses 'io.vertx.core.spi.BufferFactory'
    uses 'io.vertx.config.spi.ConfigProcessor'
  }
  launcher {
    name = 'smalldata'
    //       jvmArgs = ['-Dlog4j.configurationFile=./log4j2.xml']
    jvmArgs = ['-Djava.net.preferIPv4Stack=true']
  }
}
